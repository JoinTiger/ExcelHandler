<!DOCTYPE html><html>     <head>        <meta charset="UTF-8">        <title></title>        <script src="/js/xlsx.full.min.js"></script>		<script src="/js/jquery-3.4.0.js"></script>    </head>     <body>			        <input type="file"onchange="importf(this)" />               <script>            /*            FileReader共有4种读取方法：            1.readAsArrayBuffer(file)：将文件读取为ArrayBuffer。            2.readAsBinaryString(file)：将文件读取为二进制字符串            3.readAsDataURL(file)：将文件读取为Data URL            4.readAsText(file, [encoding])：将文件读取为文本，encoding缺省值为'UTF-8'                         */            var wb;//读取完成的数据            var rABS = false; //是否将文件读取为二进制字符串			var JSONData;             function importf(obj) {//导入                if(!obj.files) {                    return;                }                var f = obj.files[0];                var reader = new FileReader();                reader.onload = function(e) {                    var data = e.target.result;                    if(rABS) {                        wb = XLSX.read(btoa(fixdata(data)), {//手动转化                            type: 'base64'                        });                    } else {                        wb = XLSX.read(data, {                            type: 'binary'                        });                    }                    //wb.SheetNames[0]是获取Sheets中第一个Sheet的名字                    //wb.Sheets[Sheet名]获取第一个Sheet的数据					//JSONData = JSON.stringify( XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]) );					var jsono = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);					 //jdata = JSON.stringify(jsono);		 //alert(jdata);				var myData = [];		 		var tmpData = {"系统Sn号": "", "数控编号": "", "ipc编号": "", "合同编号": "", "子表": []};		var tmpInfo = {"驱动编号": "", "电机编号": ""};		 		 //alert(JSON.stringify(tmpData));		 //alert(JSON.stringify(tmpArr));		count = -1;	 		for(i in jsono) {			if(typeof jsono[i].系统Sn号 != "undefined") {				count++;				tmpData.系统Sn号 = jsono[i].系统Sn号;				tmpData.数控编号 = jsono[i].数控编号;				tmpData.ipc编号 = jsono[i].ipc编号;				tmpData.合同编号 = jsono[i].合同编号;				tmpInfo.驱动编号 = jsono[i].驱动编号;				tmpInfo.电机编号 = jsono[i].电机编号;								var newInfo = $.extend(true,{}, tmpInfo);				tmpData.子表 = [];				tmpData.子表.push(newInfo);								//alert(JSON.stringify(tmpData.子表));								var newData = $.extend(true,{}, tmpData);				myData.push(newData);								//document.write(myData[count].系统Sn号);				//document.write("<br>");				//count++;			} else {				tmpInfo.驱动编号 = jsono[i].驱动编号;				tmpInfo.电机编号 = jsono[i].电机编号;				var newInfo = $.extend(true,{}, tmpInfo);				myData[count].子表.push(newInfo);							}		}		//alert(JSON.stringify(myData));				$.ajax({					url:"/excel/import",					type:"POST",					dataType:"json",					contentType:"application/json;charset=UTF-8",					data: JSON.stringify(myData),					success:function(data, status){						console.log(data);					}				});					                };			                if(rABS) {                    reader.readAsArrayBuffer(f);                } else {                    reader.readAsBinaryString(f);                }            }             function fixdata(data) { //文件流转BinaryString                var o = "",                    l = 0,                    w = 10240;                for(; l < data.byteLength / w; ++l) o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w, l * w + w)));                o += String.fromCharCode.apply(null, new Uint8Array(data.slice(l * w)));                return o;            }         </script>				    </body> </html>